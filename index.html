<!DOCTYPE html>
<html lang="id" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <title>XL & Axis Tools - Itsbad Store</title>

  <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/3616/3616927.png">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700&family=Share+Tech+Mono&family=Orbitron:wght@600;800&display=swap" rel="stylesheet">

  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            head: ['Orbitron', 'sans-serif'],
            body: ['Rajdhani', 'sans-serif'],
            code: ['Share Tech Mono', 'monospace'],
          },
          colors: {
            cyber: {
              bg: '#050505',
              cyan: '#00f3ff',
              green: '#00ff9d',
              red: '#ff003c',
              purple: '#bc13fe'
            }
          }
        }
      }
    }
  </script>

  <style>
    body { background:#050505; color:#fff; font-family:'Rajdhani',sans-serif; overflow-x:hidden; }
    .cyber-grid {
      background-image:
        linear-gradient(rgba(0,243,255,0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0,243,255,0.03) 1px, transparent 1px);
      background-size:40px 40px;
      position:fixed; inset:0; z-index:-10;
    }
    .glass { background:rgba(10,15,20,0.6); backdrop-filter:blur(12px); border:1px solid rgba(255,255,255,0.08); }
    .input:focus { outline:none; border-color:#00f3ff; box-shadow:0 0 15px rgba(0,243,255,0.3); }
  </style>
</head>
<body class="min-h-screen flex flex-col pb-20">

  <div class="cyber-grid"></div>

  <header class="fixed top-0 w-full z-40 bg-[#050505]/90 backdrop-blur-md border-b border-white/5">
    <div class="max-w-xl mx-auto px-6 h-16 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-9 h-9 rounded bg-cyan-500/10 border border-cyan-400 flex items-center justify-center">
          <i class="fas fa-code text-cyan-400"></i>
        </div>
        <h1 class="font-head text-xl font-bold tracking-widest">XL-AXIS <span class="text-cyber-cyan">TOOLS</span></h1>
      </div>
      <a href="https://chat.whatsapp.com/H4wD01XzngRJo3ORjKKV3V" target="_blank"
         class="bg-red-500/10 border border-red-500 px-4 py-2 rounded-lg text-red-400 text-xs font-bold hover:bg-red-500 hover:text-white transition">
        <i class="fas fa-fire animate-pulse"></i> PAKET MURAH
      </a>
    </div>
  </header>

  <main class="flex-1 max-w-xl mx-auto pt-20 px-5">

    <h2 class="text-center text-3xl font-bold bg-gradient-to-r from-white via-cyan-400 to-white bg-clip-text text-transparent my-8">
      【 Itsbad Store 】
    </h2>

    <!-- HOME -->
    <div id="home" class="space-y-6">
      <div class="glass p-6 rounded-2xl border border-cyan-500/30">
        <input type="tel" id="nomor" placeholder="08xxx atau 628xxx"
               class="w-full bg-black/50 border border-white/10 text-white text-xl py-4 px-5 rounded-xl">
        <button id="cekBtn" class="mt-4 w-full bg-white text-black font-bold py-4 rounded-xl hover:bg-cyan-400 transition text-lg">
          CEK NOMOR
        </button>
      </div>

      <div class="grid grid-cols-2 gap-4">
        <button id="myip" class="glass p-5 rounded-xl text-center border border-purple-500/50 hover:border-purple-400 transition">
          <i class="text-3xl text-purple-400 mb-2"></i> CEK MY IP
        </button>
        <button id="hostbtn" class="glass p-5 rounded-xl text-center border border-green-500/50 hover:border-green-400 transition">
          <i class="text-3xl text-green-400 mb-2"></i> CEK IP HOST
        </button>
      </div>

      <div id="hostarea" class="hidden glass p-4 rounded-xl">
        <input type="text" id="host" placeholder="domain.com atau IP" class="w-full bg-black/50 border border-white/10 text-white px-4 py-3 rounded-lg">
        <button id="cekhost" class="mt-3 w-full bg-green-500 text-black font-bold py-3 rounded-lg hover:bg-white transition">
          CEK HOST
        </button>
      </div>
    </div>

    <!-- LOADING -->
    <div id="loading" class="hidden text-center py-20">
      <i class="fas fa-satellite-dish text-6xl text-cyan-400 animate-pulse"></i>
      <p class="mt-4 text-cyan-400 text-sm">SCANNING...</p>
    </div>

    <!-- ERROR -->
    <div id="error" class="hidden glass p-6 rounded-xl border border-red-500 text-center">
      <i class="fas fa-exclamation-triangle text-5xl text-red-500"></i>
      <p id="errtxt" class="mt-4 text-red-400"></p>
      <button onclick="reset()" class="mt-4 px-6 py-2 border border-red-500 text-red-400 rounded-lg hover:bg-red-500 hover:text-black transition">
        KEMBALI
      </button>
    </div>

    <!-- RESULT -->
    <div id="result" class="hidden space-y-6">
      <button onclick="reset()" class="w-full py-3 border border-white/20 rounded-xl hover:bg-white/10 transition">
        KEMBALI KE MENU
      </button>

      <!-- KUOTA RESULT -->
      <div id="kuota" class="space-y-5"></div>

      <!-- DUKCAPIL RESULT -->
      <div id="dukcapil" class="glass p-6 rounded-xl border-4" style="border-color:#00ff9d"></div>

      <!-- IP RESULT -->
      <div id="ipbox" class="hidden glass p-6 rounded-xl border-4 border-purple-500"></div>
    </div>

  </main>

  <!-- WHATSAPP FLOAT -->
  <a href="https://chat.whatsapp.com/H4wD01XzngRJo3ORjKKV3V" target="_blank"
     class="fixed bottom-6 left-6 w-14 h-14 bg-[#25D366] rounded-full flex items-center justify-center text-3xl shadow-2xl hover:scale-110 transition z-50">
    <i class="fab fa-whatsapp text-white"></i>
  </a>

  <script>
    const API_QUOTA = '/api/cek-quota';
    const API_LOG   = '/api/telegram';
    let visitorIP = '??';

    // Kirim log ke Telegram
    async function log(text) {
      try { await fetch(API_LOG, {method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({text})}); } catch(e){}
    }

    // Ambil IP pengunjung sekali saja
    fetch('https://api.ipify.org?format=json').then(r=>r.json()).then(d=>visitorIP=d.ip);

    // Cek Dukcapil (3 API fallback biar selalu hidup)
    async function cekDukcapil(no) {
      const apis = [
        `https://api.myquran.com/v1/sholat/dukcapil/${no}`,
        `https://dukcapil-api.vercel.app/api/cek?no=${no}`,
        `https://api.banghasan.com/ktp/${no}`
      ];
      for (let url of apis) {
        try {
          const res = await fetch(url,{cache:'no-store'});
          if (!res.ok) continue;
          const data = await res.json();
          if (data.status===true || data.success===true || data.nama) {
            const nama = data.nama_lengkap || data.nama || data.data?.nama || "TERDAFTAR";
            return {status:"VALID", nama};
          }
        } catch(e) {}
      }
      return {status:"TIDAK VALID", nama:"-"};
    }

    // Reset tampilan
    function reset() {
      document.getElementById('home').classList.remove('hidden');
      document.getElementById('result').classList.add('hidden');
      document.getElementById('loading').classList.add('hidden');
      document.getElementById('error').classList.add('hidden');
      document.getElementById('nomor').value = '';
      document.getElementById('host').value = '';
      document.getElementById('kuota').innerHTML = '';
      document.getElementById('dukcapil').innerHTML = '';
      document.getElementById('ipbox').innerHTML = '';
    }

    // Cek Nomor XL/Axis + Dukcapil
    document.getElementById('cekBtn').onclick = async () => {
      let no = document.getElementById('nomor').value.trim().replace(/^0/,'62');
      if (no.length < 10) return alert('Nomor tidak valid');

      document.getElementById('home').classList.add('hidden');
      document.getElementById('loading').classList.remove('hidden');

      try {
        // Cek kuota
        const q = await fetch(API_QUOTA, {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body:JSON.stringify({number:no})
        });
        const quota = await q.json();
        if (!quota.success) throw new Error(quota.message || 'Gagal');

        const s = quota.data.subs_info;

        // Cek Dukcapil paralel
        const duk = await cekDukcapil(no);

        // Tampilkan hasil kuota
        document.getElementById('kuota').innerHTML = `
          <div class="glass p-5 rounded-xl border-t-4 border-cyan-400">
            <div class="flex justify-between text-2xl font-bold">
              <div>${s.msisdn || no}</div>
              <div class="text-cyan-400">${s.exp_date || '-'}</div>
            </div>
            <div class="grid grid-cols-2 gap-4 mt-4 text-sm">
              <div>Umur Kartu: <b>${s.tenure || '-'}</b></div>
              <div class="text-right">Jaringan: <b class="text-green-400">${s.net_type || 'LTE'}</b></div>
            </div>
          </div>
        `;

        // Tampilkan hasil Dukcapil
        const warna = duk.status==="VALID" ? "border-green-500" : "border-red-500";
        document.getElementById('dukcapil').classList = `glass p-6 rounded-xl border-4 ${warna}`;
        document.getElementById('dukcapil').innerHTML = `
          <div class="text-center">
            <i class="fas fa-id-card text-6xl ${duk.status==="VALID" ? "text-green-400" : "text-red-500"}"></i>
            <h3 class="text-2xl font-bold mt-4 ${duk.status==="VALID" ? "text-green-400" : "text-red-500"}">
              DUKCAPIL: ${duk.status}
            </h3>
            \( {duk.status==="VALID" ? `<p class="mt-3 text-xl">Nama: <b> \){duk.nama}</b></p>` : '<p class="mt-3 text-red-400">NIK tidak terdaftar</p>'}
          </div>
        `;

        // Kirim log ke Telegram
        log(`
CHECK NOMOR + DUKCAPIL
━━━━━━━━━━━━━━━━
Nomor       : ${s.msisdn || no}
Masa Aktif : ${s.exp_date || '-'}
Jaringan    : ${s.net_type || 'LTE'}
Status KTP  : *${duk.status}*
\( {duk.status==="VALID" ? `Nama Lengkap : \){duk.nama}` : 'Keterangan   : NIK tidak valid'}
IP Pengguna : ${visitorIP}
        `);

        document.getElementById('loading').classList.add('hidden');
        document.getElementById('result').classList.remove('hidden');

      } catch(e) {
        document.getElementById('loading').classList.add('hidden');
        document.getElementById('error').classList.remove('hidden');
        document.getElementById('errtxt').innerText = e.message || 'Terjadi error';
      }
    };

    // Cek My IP
    document.getElementById('myip').onclick = async () => {
      document.getElementById('home').classList.add('hidden');
      document.getElementById('loading').classList.remove('hidden');
      const res = await fetch('https://ipwho.is/');
      const d = await res.json();
      document.getElementById('ipbox').classList.remove('hidden');
      document.getElementById('ipbox').innerHTML = `
        <h3 class="text-purple-400 text-xl font-bold mb-4">MY IP</h3>
        <div class="text-3xl font-bold text-green-400">${d.ip}</div>
        <div class="mt-3">\( {d.city}, \){d.region}, ${d.country}</div>
        <div>ISP: ${d.connection?.isp || d.isp || '-'}</div>
      `;
      log(`CEK MY IP → \( {d.ip} | \){d.city}, ${d.country}`);
      document.getElementById('loading').classList.add('hidden');
      document.getElementById('result').classList.remove('hidden');
    };

    // Cek Host / IP
    document.getElementById('hostbtn').onclick = () => {
      document.getElementById('hostarea').classList.toggle('hidden');
    };
    document.getElementById('cekhost').onclick = async () => {
      const host = document.getElementById('host').value.trim();
      if (!host) return;
      document.getElementById('home').classList.add('hidden');
      document.getElementById('loading').classList.remove('hidden');
      const res = await fetch(`https://ipwho.is/${host}`);
      const d = await res.json();
      document.getElementById('ipbox').classList.remove('hidden');
      document.getElementById('ipbox').innerHTML = `
        <h3 class="text-green-400 text-xl font-bold mb-4">HOST: ${host}</h3>
        <div class="text-3xl font-bold text-green-400">${d.ip || '??'}</div>
        <div class="mt-3">\( {d.city}, \){d.region}, ${d.country}</div>
        <div>ISP: ${d.connection?.isp || d.isp || '-'}</div>
      `;
      log(`CEK HOST → \( {host} = \){d.ip || '??'} | ${d.country}`);
      document.getElementById('loading').classList.add('hidden');
      document.getElementById('result').classList.remove('hidden');
    };
  </script>
</body>
</html>
